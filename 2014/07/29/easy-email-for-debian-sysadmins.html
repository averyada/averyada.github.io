<!DOCTYPE html>
<html class="no-js" lang='en'>
  <head>
    <meta charset=UTF-8>
    <title>stdout - coding and technology</title>
    <!-- Hey you! Viewing the source on my blog? Ahead may lie gross dragons..
         Anyway, it's dangerous to go alone,  take this!

               $_______________________________$$$$$
               $$$__________________________$$$$$$$
               $$$_$$____________________$$$$__$$$
               _$$___$$________________$$$$____$$
               __$____$$_____$$$$$$$$$$$$_____$$
               ___$$____$$$$$$$_____$$$_____$$$
               ____$$___$_________________$$$
               _____$$$__________________$$_____$$$$
               ______$$____________$$$$__$$$$$$$$__$$
               ______$__$$$$_______$$$$____$$______$$
               _$$$$$$__$$$$__$$____$$______$____$$$
               $$____$___$$____________$$$__$___$$$
               _$$$__$______$$$$$$____$___$_$$$$$
               ___$$$$_______$$__$_____$$$__$$$$$$$
               _____$$$$______$$$$_________$______$$
               _______$$$$______________$$________$$$$
               ______$$__$$$___$$$$$$_____________$$$$
               _____$$$_________________$$$$_____$$$$
               ____$$$$$______$$$$$$$$$$$$$$$$$$$$$
               ______$$$$$$_$$$$$$____________$$$
               __________$$$$
     -->

    <!-- Foundation stylesheets and modernizr -->
    <link rel="stylesheet" type="text/css"
          href="/css/normalize.css"/>
    <link rel="stylesheet" type="text/css"
          href="/css/foundation.css"/>

    <!-- Pygments for syntax highlighting -->
    <link rel="stylesheet" type="text/css"
          href="/css/pygments.css"/>

    <!-- Custom styles -->
    <link rel="stylesheet" type="text/css"
          href="/css/custom.css"/>
  </head>

  <!-- Gaug.es -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '50a7f3f6f5a1f51a1d000050');
      t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
      t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
  <!-- end Gaug.es -->

  <body>

    <!-- Top Bar -->
    <ul class="vertical medium-horizontal menu">
      <li class="menu-text">stdout</li>
      <li>
        <a href="/index.html">Home</a>
      </li>
      <li>
        <a href="/posts.html">Posts</a>
      </li>
      <li>
        <a href="/projects.html">Projects</a>
      </li>
      <li>
        <a href="/about.html">About</a>
      </li>
    </ul>
    <!-- End top bar -->

    <!-- Rest of site -->
<!-- old nav structure
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li class="menu-text">stdout</li>
          <li>
              <a id="home" href="/index.html">
                <span>&#8962;</span>
                <label>Home</label>
              </a>
            </li>
            <li>
              <a id="posts" href="/posts.html">
                <span>&#9776;</span>
                <label>Archive</label>
              </a>
            </li>
            <li>
              <a id="projects" href="/projects.html">
                <span>&#9000;</span>
                <label>Projects</label>
              </a>
            </li>
            <li>
              <a id="about" href="/about.html">
                <span>&#128100;</span>
                <label>About</label>
              </a>
            </li>
          </ul>
        </div>
      </div>  --><!-- end navbg -->

    <div id="main">
      <div id="wrapper">
        <div id="titlebg">
          <div class="row">
            <!-- Title -->
            <div id="title" class="columns small-12">
              <h1><span id="stdout">stdout</span>Coding and Technology</h1>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="row">
          <div id="content" class="columns small-centered small-12 large-9">
            <div class="post">
  <!-- Post header -->
  <div class="row">
    <div class="columns small-12 large-uncentered large-10">
      <a href="/2014/07/29/easy-email-for-debian-sysadmins.html">
        <h1 class="post-title">Easy Email for Debian Sysadmins</h1>
      </a>
    </div>
    <div class="columns small-6 large-uncentered large-2">
      <a href="http://facebook.com/sharer.php?u=http://www.bpace.info/2014/07/29/easy-email-for-debian-sysadmins.html">
        <span class="entypo-social right">&#62222;</span>
      </a>
      <a href="https://plus.google.com/share?url=http://www.bpace.info/2014/07/29/easy-email-for-debian-sysadmins.html">
        <span class="entypo-social right">&#62223;</span>
      </a>
      <a href="http://twitter.com/share?text=Easy+Email+for+Debian+Sysadmins&url=http://www.bpace.info/2014/07/29/easy-email-for-debian-sysadmins.html">
        <span class="entypo-social right">&#62217;</span>
      </a>
    </div>
    <div class="row">
      <div class="columns small-6 medium-6 large-centered post-date">
        July 29, 2014
      </div>
    </div>
  </div>
  <br>
  <!-- Post content -->
  <div class="row">
    <div class="columns small-12 post-content"><p>If you have a Debian server, there are different reasons that you might not want
to run a mail server, or you might not even be able to. Setting up postfix or
sendmail can be a complicated, daunting task that not a lot of people have the
time or interest to do. Even if you want to, if you’re running your server at
home there’s a good chance your ISP blocks outgoing email on port 25. This is a
simple solution for setting up outgoing-only SMTP for your server.</p>

<p>The two things we’ll be using to accomplish this are SSMTP and Amazon SES.
Simple SMTP is a mail transfer agent, but all it does is relay your messages to
a real, remote SMTP server. Amazon SES is what we’ll use for the actual email
account that sends your emails. You can use a Google account with SSMTP, but
this is against the TOS for most webmail, and generally your address will be
autodetected and banned if you do this. In contrast, SES is designed for
automated bulk email delivery and this is a perfect use case for it.</p>

<p>There are two ways to set up Amazon SES. The more complicated but powerful way
requires you to own your own domain name. You can always pick up a <code class="highlighter-rouge">.info</code>
domain name for $2.99 at <a href="https://www.godaddy.com/">GoDaddy</a>, at least for the first year, but you
don’t need to.</p>

<p>The other option is to verify your own address, and send email to yourself from
SES to your provider. If that sounds a bit confusing, it should become more
clear as we go over the configuration. It will appear as though your email comes
from gmail or yahoo, but it will really originate from SES. It’s like a ghost
version of you is emailing yourself. No matter your decision, you’ll want to
create an account at the <a href="https://aws.amazon.com/">Amazon Web Services</a> portal.</p>

<h2 id="domain-name-verification">Domain Name Verification</h2>

<p>If you go the domain name route, you can send your email from whichever address
you’d like. You can receive email from “myserver@myhostname.com” and send it to
“my.name@gmail.com”, or any other setup you could think of. The following
explains how to set this up, but you can safely skip it if you’re not
configuring a custom domain.</p>

<p>With your newly created Amazon account, log in and navigate to the
<a href="https://console.aws.amazon.com/ses/">SES Management Console</a>. In the “Domains” section, click “Verify a New
Domain” and enter the domain you own or purchased. Make sure to check “Generate
DKIM Settings”, Gmail is a bit happier receiving email when these are set.</p>

<p>The next page will list a <code class="highlighter-rouge">TXT</code> and three <code class="highlighter-rouge">CNAME</code> records for your domain. Open
another tab or download these as CSV, and log into your domain registrar’s
website. If you purchased a domain from GoDaddy, that’s where you’ll want to
head. Launch the Domain Manager, find your domain and edit the “DNS Zone
File”. This is where you want to add those records that Amazon generated for
you.</p>

<p>After you’ve done this you might need to wait up to a few hours. DNS propagation
can take awhile (you can speed this up a little by lowering the TTL value), and
then Amazon needs to verify these records before you can continue. When I tested
this it only took about 10 minutes though.</p>

<h2 id="single-email-address-verification">Single Email Address Verification</h2>

<p>On the other hand, if you’d like to forego your own domain you can just verify
your personal email account. Visit the <a href="https://console.aws.amazon.com/ses/">SES Management Console</a> and click
the “Email Addresses” section. Assuming you use gmail, click “Verify a New Email
Address” and enter your.address@gmail.com.</p>

<p>The rest is pretty standard, you’ll receive an email and just click on the link
to verify you own that address. That’s all you need to do.</p>

<h2 id="setting-up-your-server">Setting up your Server</h2>

<p>That’s it for verification, and now you can login to your server proper to
finish things up. The first step here is to install the <code class="highlighter-rouge">SSMTP</code> package.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install ssmtp
</code></pre>
</div>

<p>SSMTP stores its configuration in <code class="highlighter-rouge">/etc/ssmtp/ssmtp.conf</code>. It takes a couple
fields, and I’ve listed the configuration you need for Amazon SES. Double check
the mailhub setting, accessible in the <a href="https://console.aws.amazon.com/ses/">SES Console</a>, as you might be in a
different region than me. For the <code class="highlighter-rouge">AuthUser</code> and <code class="highlighter-rouge">AuthPass</code> fields, you need to
click on the “Generate SMTP Settings” button and create an Amazon Identity and
Access Management (IAM) user. It will provide you with proper SMTP credentials.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root=your.name@gmail.com # Email sent to root is forwarded here
UseTLS=YES
mailhub=email-smtp.us-east-1.amazonaws.com:465
AuthUser=AKIAR6999999AAAAA99999 # You need to generate this for yourself
AuthPass=As7p8A3asdf3*sdfaasd3D # Same here, these are fake entries.
</code></pre>
</div>

<h3 id="domain-setup">Domain Setup</h3>

<p>For domain setup, you also need to add a hostname field to <code class="highlighter-rouge">ssmtp.conf</code>. If
you’re doing single address configuration, just skip this section too.
Otherwise, the hostname field you add must match the domain name you verified
for use with SES.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hostname=bpace.info
</code></pre>
</div>

<p>At this point your email should be working, and you’ll receive email from
useraccount@bpace.info for every user on the system. For example, root email
will arrive separately. coming from root@bpace.info. If you’d like to tweak
this behavior, you can also create <code class="highlighter-rouge">/etc/ssmtp/revaliases</code> and add something
similar to this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root:servername@bpace.info
pacebl:servername@bpace.info
</code></pre>
</div>

<p>You don’t need the <code class="highlighter-rouge">revaliases</code> file though, and everything should be working at
this point. The only thing left is to filter away these emails to your heart’s
content.</p>

<h3 id="single-address-setup">Single Address Setup</h3>

<p>If you’re setting up a single address, you just need to add the <code class="highlighter-rouge">revaliases</code>
file at <code class="highlighter-rouge">/etc/ssmtp/revaliases</code> and add the following information.
You can add a label to the verified address, which is the portion after the <code class="highlighter-rouge">+</code>
and before the <code class="highlighter-rouge">@</code> symbols below. This is useful for filtering these automated
messages.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>root:your.name+rootbpace@gmail.com
bpace:your.name+bpace@gmail.com
</code></pre>
</div>

<p>Even if you don’t want to add a label, for each user account you want to receive
email from you need to add a <code class="highlighter-rouge">revaliases</code> entry pointing to your address. If you
don’t, ssmtp will attempt to send mail from addresses such as “root@gmail.com”.
SES will just complain you haven’t verified these addresses and refuse to
deliver your mail.</p>

<p>After this, everything should be working for single address mode. Enjoy
receiving email from your servers without a real mail server.</p>

</div>
  </div>
</div>
<br>

          </div>
        </div>
        <div class="adunit_small">
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-9231989683269805";
  /* sm_banner */
  google_ad_slot = "3508818774";
  google_ad_width = 320;
  google_ad_height = 50;
  //-->
  </script>
  <script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>

      </div>
    </div>

    <footer id="footer">
      <div class="show-for-large-up" id="quote">
        <a href="http://www.catb.org/~esr/writings/unix-koans/">
        There is more Unix-nature in one line of shell script than there is in
        ten thousand lines of C.
      </a>
      </div>
      <div class="row">
        <div id="footernav" class="columns small-6">
          <a href="https://www.github.com/pacebl">
            <span class="entypo-social">&#62208;</span>
            <label>Github</label>
          </a>
          <a href="https://www.twitter.com/bl_pace">
            <span class="entypo-social">&#62217;</span>
            <label>Twitter</label>
          </a>
        </div>
        <span id="entypo-attribution" class="columns small-6">
          <a href="http://www.entypo.com">Entypo pictograms by Daniel Bruce</a>
        </span>
      </div>
    </footer>



    <!-- Foundation JS -->
    <script src="/js/vendor/jquery.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>

    <script>
      $(document).foundation();
    </script>
    <!-- End Foundation JS -->
  </body>
</html>
