<!DOCTYPE html>
<html class="no-js" lang='en'>
  <head>
    <meta charset=UTF-8>
    <title>stdout - coding and technology</title>
    <!-- Hey you! Viewing the source on my blog? Ahead may lie gross dragons..
         Anyway, it's dangerous to go alone,  take this!

               $_______________________________$$$$$
               $$$__________________________$$$$$$$
               $$$_$$____________________$$$$__$$$
               _$$___$$________________$$$$____$$
               __$____$$_____$$$$$$$$$$$$_____$$
               ___$$____$$$$$$$_____$$$_____$$$
               ____$$___$_________________$$$
               _____$$$__________________$$_____$$$$
               ______$$____________$$$$__$$$$$$$$__$$
               ______$__$$$$_______$$$$____$$______$$
               _$$$$$$__$$$$__$$____$$______$____$$$
               $$____$___$$____________$$$__$___$$$
               _$$$__$______$$$$$$____$___$_$$$$$
               ___$$$$_______$$__$_____$$$__$$$$$$$
               _____$$$$______$$$$_________$______$$
               _______$$$$______________$$________$$$$
               ______$$__$$$___$$$$$$_____________$$$$
               _____$$$_________________$$$$_____$$$$
               ____$$$$$______$$$$$$$$$$$$$$$$$$$$$
               ______$$$$$$_$$$$$$____________$$$
               __________$$$$
     -->

    <!-- Foundation stylesheets and modernizr -->
    <link rel="stylesheet" type="text/css"
          href="/css/normalize.css"/>
    <link rel="stylesheet" type="text/css"
          href="/css/foundation.css"/>

    <!-- Pygments for syntax highlighting -->
    <link rel="stylesheet" type="text/css"
          href="/css/pygments.css"/>

    <!-- Custom styles -->
    <link rel="stylesheet" type="text/css"
          href="/css/custom.css"/>
  </head>

  <!-- Gaug.es -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '50a7f3f6f5a1f51a1d000050');
      t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
      t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
  <!-- end Gaug.es -->

  <body>

    <!-- Top Bar -->
    <ul class="vertical medium-horizontal menu">
      <li class="menu-text">stdout</li>
      <li>
        <a href="/index.html">Home</a>
      </li>
      <li>
        <a href="/posts.html">Posts</a>
      </li>
      <li>
        <a href="/projects.html">Projects</a>
      </li>
      <li>
        <a href="/about.html">About</a>
      </li>
    </ul>
    <!-- End top bar -->

    <!-- Rest of site -->
<!-- old nav structure
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li class="menu-text">stdout</li>
          <li>
              <a id="home" href="/index.html">
                <span>&#8962;</span>
                <label>Home</label>
              </a>
            </li>
            <li>
              <a id="posts" href="/posts.html">
                <span>&#9776;</span>
                <label>Archive</label>
              </a>
            </li>
            <li>
              <a id="projects" href="/projects.html">
                <span>&#9000;</span>
                <label>Projects</label>
              </a>
            </li>
            <li>
              <a id="about" href="/about.html">
                <span>&#128100;</span>
                <label>About</label>
              </a>
            </li>
          </ul>
        </div>
      </div>  --><!-- end navbg -->

    <div id="main">
      <div id="wrapper">
        <div id="titlebg">
          <div class="row">
            <!-- Title -->
            <div id="title" class="columns small-12">
              <h1><span id="stdout">stdout</span>Coding and Technology</h1>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="row">
          <div id="content" class="columns small-centered small-12 large-9">
            <div class="post">
  <!-- Post header -->
  <div class="row">
    <div class="columns small-12 large-uncentered large-10">
      <a href="/2014/06/05/unit-testing-in-rust.html">
        <h1 class="post-title">Unit Testing in Rust</h1>
      </a>
    </div>
    <div class="columns small-6 large-uncentered large-2">
      <a href="http://facebook.com/sharer.php?u=http://www.bpace.info/2014/06/05/unit-testing-in-rust.html">
        <span class="entypo-social right">&#62222;</span>
      </a>
      <a href="https://plus.google.com/share?url=http://www.bpace.info/2014/06/05/unit-testing-in-rust.html">
        <span class="entypo-social right">&#62223;</span>
      </a>
      <a href="http://twitter.com/share?text=Unit+Testing+in+Rust&url=http://www.bpace.info/2014/06/05/unit-testing-in-rust.html">
        <span class="entypo-social right">&#62217;</span>
      </a>
    </div>
    <div class="row">
      <div class="columns small-6 medium-6 large-centered post-date">
        June 05, 2014
      </div>
    </div>
  </div>
  <br>
  <!-- Post content -->
  <div class="row">
    <div class="columns small-12 post-content"><p><a href="http://www.rust-lang.org/">Rust</a> is a new open source systems programming language which
guarantees memory safety and supports concurrency without data races. It’s not
actually an official Mozilla project, but rather something to come out of the
Mozilla community. It’s a compiled, minimal runtime language that manages to
feel like C++ and Ruby at the same time. The current “stable” release is 0.10,
and many things are in flux currently as developers work hard to push towards
the 1.0 release.</p>

<p>I’ve just been scratching the surface of the features of Rust, but I was very
intrigued by the built in unit testing framework and how it integrates with Rust
code.</p>

<p>Your unit tests can live within the same file as your actual code. I’m not sure
whether this is Rust best practice or not, the standard idioms for Rust code are
still being worked out too. If functions are marked with a <code class="highlighter-rouge">#[test]</code> identifier,
it tells the rust compiler that the function is a unit test. Here’s an example.</p>

<figure class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">three_divides</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
  <span class="n">num</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">num</span> <span class="n">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nf">three_divides</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"Three divides "</span> <span class="o">+</span> <span class="n">num</span><span class="nf">.to_str</span><span class="p">())</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"Three doesn't divide "</span> <span class="o">+</span> <span class="n">num</span><span class="nf">.to_str</span><span class="p">())</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#[test]</span>
<span class="k">fn</span> <span class="nf">test_three_doesnt_divide</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="o">!</span><span class="nf">three_divides</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#[test]</span>
<span class="k">fn</span> <span class="nf">test_three_divides</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">assert</span><span class="o">!</span><span class="p">(</span><span class="nf">three_divides</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure>

<p>As a quick aside, notice that the statement in the function <code class="highlighter-rouge">three_divides</code> is
not terminated with a semi-colon. Rust interprets this in a special way, and
automatically returns the value of the statement as the function’s result.</p>

<p>To run your application, it’s pretty straightforward. Invoke the rust
compiler, <code class="highlighter-rouge">rustc</code> with your source code and it’ll hopefully output a binary.
Run that binary and watch as your code runs. The test functions were ignored,
their symbols never even added to your executable.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>λ ~/ rustc divide.rs
λ ~/ ./divide 
Three doesn't divide 1
Three doesn't divide 2
Three divides 3
Three doesn't divide 4
Three doesn't divide 5
Three divides 6
Three doesn't divide 7
Three doesn't divide 8
Three divides 9
</code></pre>
</div>

<p>When it’s time to run your tests, compile your application again but this time
pass the <code class="highlighter-rouge">--test</code> flag to <code class="highlighter-rouge">rustc</code>. It will remove your main function, instead
compiling your application with a test runner that automatically knows to run
all your functions marked with <code class="highlighter-rouge">#[test]</code>. Note that <code class="highlighter-rouge">assert!</code> calls a function
which returns a boolean, and if <code class="highlighter-rouge">assert!</code> receives <code class="highlighter-rouge">true</code> it passes the unit
test. Obviously the reverse will fail the test.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>λ ~/ rustc --test divide.rs
λ ~/ ./divide 

running 2 tests
test test_three_divides ... ok
test test_three_doesnt_divide ... ok

test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured
</code></pre>
</div>

<p>Having this kind of unit testing support baked right into the language is really
nice, and I couldn’t stop thinking about how convenient this kind of testing is.
It lowers the barrier to writing tests and removes a lot of headache about
setting up a testing framework or environment.  If you know some other cool
features of the rust testing system, or I’ve performed a best practices faux
pas, drop me a line on <a href="https://www.twitter.com/bl_pace">Twitter</a>.</p>

</div>
  </div>
</div>
<br>

          </div>
        </div>
        <div class="adunit_small">
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-9231989683269805";
  /* sm_banner */
  google_ad_slot = "3508818774";
  google_ad_width = 320;
  google_ad_height = 50;
  //-->
  </script>
  <script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>

      </div>
    </div>

    <footer id="footer">
      <div class="show-for-large-up" id="quote">
        <a href="http://www.catb.org/~esr/writings/unix-koans/">
        There is more Unix-nature in one line of shell script than there is in
        ten thousand lines of C.
      </a>
      </div>
      <div class="row">
        <div id="footernav" class="columns small-6">
          <a href="https://www.github.com/pacebl">
            <span class="entypo-social">&#62208;</span>
            <label>Github</label>
          </a>
          <a href="https://www.twitter.com/bl_pace">
            <span class="entypo-social">&#62217;</span>
            <label>Twitter</label>
          </a>
        </div>
        <span id="entypo-attribution" class="columns small-6">
          <a href="http://www.entypo.com">Entypo pictograms by Daniel Bruce</a>
        </span>
      </div>
    </footer>



    <!-- Foundation JS -->
    <script src="/js/vendor/jquery.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>

    <script>
      $(document).foundation();
    </script>
    <!-- End Foundation JS -->
  </body>
</html>
