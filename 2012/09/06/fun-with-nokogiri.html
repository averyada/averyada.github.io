<!DOCTYPE html>
<html class="no-js" lang='en'>
  <head>
    <meta charset=UTF-8>
    <title>stdout - coding and technology</title>
    <!-- Hey you! Viewing the source on my blog? Ahead may lie gross dragons..
         Anyway, it's dangerous to go alone,  take this!

               $_______________________________$$$$$
               $$$__________________________$$$$$$$
               $$$_$$____________________$$$$__$$$
               _$$___$$________________$$$$____$$
               __$____$$_____$$$$$$$$$$$$_____$$
               ___$$____$$$$$$$_____$$$_____$$$
               ____$$___$_________________$$$
               _____$$$__________________$$_____$$$$
               ______$$____________$$$$__$$$$$$$$__$$
               ______$__$$$$_______$$$$____$$______$$
               _$$$$$$__$$$$__$$____$$______$____$$$
               $$____$___$$____________$$$__$___$$$
               _$$$__$______$$$$$$____$___$_$$$$$
               ___$$$$_______$$__$_____$$$__$$$$$$$
               _____$$$$______$$$$_________$______$$
               _______$$$$______________$$________$$$$
               ______$$__$$$___$$$$$$_____________$$$$
               _____$$$_________________$$$$_____$$$$
               ____$$$$$______$$$$$$$$$$$$$$$$$$$$$
               ______$$$$$$_$$$$$$____________$$$
               __________$$$$
     -->

    <!-- Foundation stylesheets and modernizr -->
    <link rel="stylesheet" type="text/css"
          href="/css/normalize.css"/>
    <link rel="stylesheet" type="text/css"
          href="/css/foundation.css"/>

    <!-- Pygments for syntax highlighting -->
    <link rel="stylesheet" type="text/css"
          href="/css/pygments.css"/>

    <!-- Custom styles -->
    <link rel="stylesheet" type="text/css"
          href="/css/custom.css"/>
  </head>

  <!-- Gaug.es -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '50a7f3f6f5a1f51a1d000050');
      t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
      t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
  <!-- end Gaug.es -->

  <body>

    <!-- Top Bar -->
    <ul class="vertical medium-horizontal menu">
      <li class="menu-text">stdout</li>
      <li>
        <a href="/index.html">Home</a>
      </li>
      <li>
        <a href="/posts.html">Posts</a>
      </li>
      <li>
        <a href="/projects.html">Projects</a>
      </li>
      <li>
        <a href="/about.html">About</a>
      </li>
    </ul>
    <!-- End top bar -->

    <!-- Rest of site -->
<!-- old nav structure
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li class="menu-text">stdout</li>
          <li>
              <a id="home" href="/index.html">
                <span>&#8962;</span>
                <label>Home</label>
              </a>
            </li>
            <li>
              <a id="posts" href="/posts.html">
                <span>&#9776;</span>
                <label>Archive</label>
              </a>
            </li>
            <li>
              <a id="projects" href="/projects.html">
                <span>&#9000;</span>
                <label>Projects</label>
              </a>
            </li>
            <li>
              <a id="about" href="/about.html">
                <span>&#128100;</span>
                <label>About</label>
              </a>
            </li>
          </ul>
        </div>
      </div>  --><!-- end navbg -->

    <div id="main">
      <div id="wrapper">
        <div id="titlebg">
          <div class="row">
            <!-- Title -->
            <div id="title" class="columns small-12">
              <h1><span id="stdout">stdout</span>Coding and Technology</h1>
            </div>
          </div>
        </div>

        <!-- Content -->
        <div class="row">
          <div id="content" class="columns small-centered small-12 large-9">
            <div class="post">
  <!-- Post header -->
  <div class="row">
    <div class="columns small-12 large-uncentered large-10">
      <a href="/2012/09/06/fun-with-nokogiri.html">
        <h1 class="post-title">Fun with Nokogiri and XKCD</h1>
      </a>
    </div>
    <div class="columns small-6 large-uncentered large-2">
      <a href="http://facebook.com/sharer.php?u=http://www.bpace.info/2012/09/06/fun-with-nokogiri.html">
        <span class="entypo-social right">&#62222;</span>
      </a>
      <a href="https://plus.google.com/share?url=http://www.bpace.info/2012/09/06/fun-with-nokogiri.html">
        <span class="entypo-social right">&#62223;</span>
      </a>
      <a href="http://twitter.com/share?text=Fun+with+Nokogiri+and+XKCD&url=http://www.bpace.info/2012/09/06/fun-with-nokogiri.html">
        <span class="entypo-social right">&#62217;</span>
      </a>
    </div>
    <div class="row">
      <div class="columns small-6 medium-6 large-centered post-date">
        September 06, 2012
      </div>
    </div>
  </div>
  <br>
  <!-- Post content -->
  <div class="row">
    <div class="columns small-12 post-content"><p>I was bored and decided to play around with XPath and see what I could quickly
script up in a half hour or so.</p>

<p>I decided doing some kind of scraping would be a fun little mini-project, so I
set my sights on scraping down the comic images from the XKCD site.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="c1">#!/usr/bin/env ruby</span>
    <span class="nb">require</span> <span class="s1">'open-uri'</span>
    <span class="nb">require</span> <span class="s1">'nokogiri'</span>
    
    <span class="vi">@uri</span> <span class="o">=</span> <span class="s2">"http://www.xkcd.com/"</span>
    <span class="vi">@comics</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span>
    
    <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="vi">@uri</span><span class="si">}</span><span class="s2">/archive"</span><span class="p">))</span>
    
    <span class="n">doc</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s1">'//div[@id="middleContainer"]/a'</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span>
      <span class="vi">@comics</span> <span class="o">&lt;&lt;</span> <span class="no">URI</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s1">'href'</span><span class="p">])</span>
    <span class="k">end</span>
    
    <span class="vi">@comics</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="vi">@uri</span><span class="si">}#{</span><span class="n">link</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
      <span class="n">doc</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s1">'//div[@id="comic"]'</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">image</span><span class="o">|</span>
        <span class="n">image</span><span class="p">.</span><span class="nf">children</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
          <span class="k">if</span> <span class="n">child</span><span class="p">.</span><span class="nf">node_name</span> <span class="o">==</span> <span class="s1">'img'</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="s1">'src'</span><span class="p">])</span>
            <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
              <span class="n">resp</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span>
              <span class="nb">open</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">path</span><span class="p">),</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
                <span class="n">file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="nf">body</span><span class="p">)</span>
              <span class="k">end</span>
            <span class="k">end</span>
            <span class="nb">puts</span> <span class="s2">"Grabbing </span><span class="si">#{</span><span class="n">uri</span><span class="si">}</span><span class="s2">"</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span></code></pre></figure>

<p>The source code is also available on <a href="http://www.github.com/sensae/xkcd_scraper">github</a>. Be nice to
Randall’s server though!</p>

</div>
  </div>
</div>
<br>

          </div>
        </div>
        <div class="adunit_small">
  <script type="text/javascript"><!--
  google_ad_client = "ca-pub-9231989683269805";
  /* sm_banner */
  google_ad_slot = "3508818774";
  google_ad_width = 320;
  google_ad_height = 50;
  //-->
  </script>
  <script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
  </script>
</div>

      </div>
    </div>

    <footer id="footer">
      <div class="show-for-large-up" id="quote">
        <a href="http://www.catb.org/~esr/writings/unix-koans/">
        There is more Unix-nature in one line of shell script than there is in
        ten thousand lines of C.
      </a>
      </div>
      <div class="row">
        <div id="footernav" class="columns small-6">
          <a href="https://www.github.com/pacebl">
            <span class="entypo-social">&#62208;</span>
            <label>Github</label>
          </a>
          <a href="https://www.twitter.com/bl_pace">
            <span class="entypo-social">&#62217;</span>
            <label>Twitter</label>
          </a>
        </div>
        <span id="entypo-attribution" class="columns small-6">
          <a href="http://www.entypo.com">Entypo pictograms by Daniel Bruce</a>
        </span>
      </div>
    </footer>



    <!-- Foundation JS -->
    <script src="/js/vendor/jquery.js"></script>
    <script src="/js/vendor/foundation.min.js"></script>

    <script>
      $(document).foundation();
    </script>
    <!-- End Foundation JS -->
  </body>
</html>
